; ======================================================
;  Airsoft Stalker Anomalous Project (ASAP)
;  Multi-device STM32 PlatformIO setup
; ======================================================

[platformio]
default_envs = detector

; === BASE STM32 (inlined config) ===
[common_stm32]
platform = ststm32
framework = arduino
board = bluepill_f103c8
upload_protocol = stlink
monitor_speed = 115200
lib_deps =
  olikraus/U8g2 @ ^2.36.2
build_flags =
  -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
  -D USBCON
  -D U8G2_16BIT
  -D ASAP_VERSION=\"0.1.0\"

; === DEVICE: DETECTOR ===
[env:detector]
platform = ${common_stm32.platform}
framework = ${common_stm32.framework}
board = ${common_stm32.board}
upload_protocol = ${common_stm32.upload_protocol}
monitor_speed = ${common_stm32.monitor_speed}
lib_deps = ${common_stm32.lib_deps}
build_flags = ${common_stm32.build_flags} -D DEVICE_DETECTOR
build_src_filter = +<main_detector.cpp> +<main_common.cpp>

; === DEVICE: BEACON ===
[env:beacon]
platform = ${common_stm32.platform}
framework = ${common_stm32.framework}
board = ${common_stm32.board}
upload_protocol = ${common_stm32.upload_protocol}
monitor_speed = ${common_stm32.monitor_speed}
lib_deps = ${common_stm32.lib_deps}
build_flags = ${common_stm32.build_flags} -D DEVICE_BEACON
build_src_filter = +<main_beacon.cpp> +<main_common.cpp>

; === DEVICE: ARTIFACT ===
[env:artifact]
platform = ${common_stm32.platform}
framework = ${common_stm32.framework}
board = ${common_stm32.board}
upload_protocol = ${common_stm32.upload_protocol}
monitor_speed = ${common_stm32.monitor_speed}
lib_deps = ${common_stm32.lib_deps}
build_flags = ${common_stm32.build_flags} -D DEVICE_ARTIFACT
build_src_filter = +<main_artifact.cpp> +<main_common.cpp>

; === DEVICE: ANOMALY ===
[env:anomaly]
platform = ${common_stm32.platform}
framework = ${common_stm32.framework}
board = ${common_stm32.board}
upload_protocol = ${common_stm32.upload_protocol}
monitor_speed = ${common_stm32.monitor_speed}
lib_deps = ${common_stm32.lib_deps}
build_flags = ${common_stm32.build_flags} -D DEVICE_ANOMALY
build_src_filter = +<main_anomaly.cpp> +<main_common.cpp>

; === TESTS SUR PC ===
[env:native]
platform = native
framework =
test_build_src = false
build_flags =
  -D ASAP_VERSION=\"0.1.0\"
  -D LOG_USE_STDOUT
