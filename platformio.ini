; PlatformIO Project Configuration File

[platformio]
default_envs = native
description = Airsoft Stalker

; ============================================================
; COMMON SETTINGS FOR STM32 (Bluepill + HAL + U8g2)
; ============================================================
[common_stm32]
platform = ststm32
framework = stm32cube
board = bluepill_f103c8
upload_protocol = stlink
monitor_speed = 115200

; U8g2 vendored under lib/U8g2 (C/C++ API, no Arduino framework)
lib_deps =
lib_ldf_mode = deep+
lib_compat_mode = off

; CubeMX-generated code expected under ./cube/
; Adjust paths if you put it somewhere else.
build_flags =
    -DUSE_HAL_DRIVER
    -DSTM32F103xB
    -D ASAP_VERSION=\"0.1.0\"
    -D ASAP_EMBEDDED
    -ICore/Inc
    -IDrivers/STM32F1xx_HAL_Driver/Inc
    -IDrivers/CMSIS/Device/ST/STM32F1xx/Include
    -IDrivers/CMSIS/Include
    -Ilib/U8g2/src
    -Ilib/U8g2/src/clib

; Common source filter: 
; - your shared app logic in src/main_common.cpp
; - all CubeMX C files under cube/Core/Src and cube/Drivers
build_src_filter = 
    +<main_common.cpp>
    +<../Core/Src/>

; ============================================================
; DEVICE VARIANTS (all share HAL + U8g2 + common code)
; ============================================================

[env:detector]
platform        = ${common_stm32.platform}
framework       = ${common_stm32.framework}
board           = ${common_stm32.board}
upload_protocol = ${common_stm32.upload_protocol}
monitor_speed   = ${common_stm32.monitor_speed}
lib_deps        = ${common_stm32.lib_deps}

build_flags     = ${common_stm32.build_flags} -D DEVICE_DETECTOR
build_src_filter = 
    ${common_stm32.build_src_filter}
    +<main_detector.cpp>

[env:beacon]
platform        = ${common_stm32.platform}
framework       = ${common_stm32.framework}
board           = ${common_stm32.board}
upload_protocol = ${common_stm32.upload_protocol}
monitor_speed   = ${common_stm32.monitor_speed}
lib_deps        = ${common_stm32.lib_deps}

build_flags     = ${common_stm32.build_flags} -D DEVICE_BEACON
build_src_filter = 
    ${common_stm32.build_src_filter}
    +<main_beacon.cpp>

[env:artifact]
platform        = ${common_stm32.platform}
framework       = ${common_stm32.framework}
board           = ${common_stm32.board}
upload_protocol = ${common_stm32.upload_protocol}
monitor_speed   = ${common_stm32.monitor_speed}
lib_deps        = ${common_stm32.lib_deps}

build_flags     = ${common_stm32.build_flags} -D DEVICE_ARTIFACT
build_src_filter = 
    ${common_stm32.build_src_filter}
    +<main_artifact.cpp>

[env:anomaly]
platform        = ${common_stm32.platform}
framework       = ${common_stm32.framework}
board           = ${common_stm32.board}
upload_protocol = ${common_stm32.upload_protocol}
monitor_speed   = ${common_stm32.monitor_speed}
lib_deps        = ${common_stm32.lib_deps}

build_flags     = ${common_stm32.build_flags} -D DEVICE_ANOMALY
build_src_filter = 
    ${common_stm32.build_src_filter}
    +<main_anomaly.cpp>

; ============================================================
; NATIVE ENV (PC SIMULATION / TESTS)
; ============================================================

[env:native]
platform = native
test_build_src = false
;test_filter = native_basic
test_ignore = gcc
test_framework = custom
build_flags = 
    -D ASAP_VERSION=\"0.1.0\"
    -D LOG_USE_STDOUT
    -D ASAP_NATIVE
    -Ilib/U8g2/src
    -Ilib/U8g2/src/clib
    -std=gnu++17
    -Wl,-e,mainCRTStartup
lib_archive = no
lib_ldf_mode = deep+
lib_compat_mode = off
